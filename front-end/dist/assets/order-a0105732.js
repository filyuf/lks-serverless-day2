import{aQ as j,A as U,B as W,C as S,x as V,a1 as L,y as z,aR as Y,K as $,g as J,m as Q,e as K,f as t,aS as Z,aC as N,G,o as I,q as D,k as o,w as l,c as E,aT as X,aU as H,n as M,V as g,a as s,aP as b,t as O,ab as ee,aV as te,aO as se,aW as oe,aX as ne,p as ae,r as B}from"./index-ba899fcd.js";import{u as le,h as ie}from"./orderStore-6ecc7bf8.js";import{V as R}from"./VCard-810de1be.js";import{V as A}from"./VDivider-35d02f38.js";import{V as re}from"./VImg-4b84191f.js";import{f as de}from"./forwardRefs-a29b5f65.js";import"./VAvatar-7fc9f89c.js";const q=e=>e==null||e===""?!0:!!(Array.isArray(e)&&e.length===0),ce=e=>e==null,ue=e=>Array.isArray(e)&&e.length===0,P=e=>ce(e)||ue(e)||e===!1?"This field is required":!!String(e).trim().length||"This field is required",fe=e=>{if(q(e))return!0;const a=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return Array.isArray(e)?e.every(m=>a.test(String(m)))||"The Email field must be a valid email":a.test(String(e))||"The Email field must be a valid email"},me=e=>q(e)?!0:Array.isArray(e)?e.every(a=>/^-?[0-9]+$/.test(String(a)))||"This field must be an integer":/^-?[0-9]+$/.test(String(e))||"This field must be an integer",he=`${{}.VITE_WEBSOCKET_URL}`,pe=j("websocketStore",{state:()=>({socket:null,isConnected:!1,connectionId:null,message:""}),actions:{connect(){this.socket==null&&(this.socket=new WebSocket(he)),this.socket.onopen=()=>{console.log("Websocket connection open"),this.isConnected=!0,this.getConnectionId()},this.socket.onmessage=e=>{try{const a=JSON.parse(e.data);a.connectionId?(this.connectionId=a.connectionId,a.status&&(this.message=a.status)):console.log("Received message:",a)}catch{console.log("Received message:",e.data)}},this.socket.onclose=()=>{console.log("WebSocket connection closed")}},getConnectionId(){const e={action:"getConnectionId"};this.socket.send(JSON.stringify(e))},privateMessage(e,a){if(this.socket&&this.isConnected){const m={action:"sendMessage",message:e,targetId:a};this.socket.send(JSON.stringify(m))}},broadcastMessage(e){if(this.socket&&this.isConnected){const a={action:"broadcastMessage",message:e};this.socket.send(JSON.stringify(a))}},disconnect(){this.isConnected&&(this.isConnected=!1,this.connectionId=null,this.socket.close())}}}),ge=Symbol.for("vuetify:form"),_e=U({disabled:Boolean,fastFail:Boolean,readonly:Boolean,modelValue:{type:Boolean,default:null},validateOn:{type:String,default:"input"}},"form");function ye(e){const a=W(e,"modelValue"),m=S(()=>e.disabled),v=S(()=>e.readonly),_=V(!1),i=V([]),h=V([]);async function w(){const n=[];let r=!0;h.value=[],_.value=!0;for(const p of i.value){const d=await p.validate();if(d.length>0&&(r=!1,n.push({id:p.id,errorMessages:d})),!r&&e.fastFail)break}return h.value=n,_.value=!1,{valid:r,errors:h.value}}function u(){i.value.forEach(n=>n.reset()),a.value=null}function y(){i.value.forEach(n=>n.resetValidation()),h.value=[],a.value=null}return L(i,()=>{let n=0,r=0;const p=[];for(const d of i.value)d.isValid===!1?(r++,p.push({id:d.id,errorMessages:d.errorMessages})):d.isValid===!0&&n++;h.value=p,a.value=r>0?!1:n===i.value.length?!0:null},{deep:!0}),z(ge,{register:n=>{let{id:r,validate:p,reset:d,resetValidation:C}=n;i.value.some(k=>k.id===r)&&Y(`Duplicate input name "${r}"`),i.value.push({id:r,validate:p,reset:d,resetValidation:C,isValid:null,errorMessages:[]})},unregister:n=>{i.value=i.value.filter(r=>r.id!==n)},update:(n,r,p)=>{const d=i.value.find(C=>C.id===n);d&&(d.isValid=r,d.errorMessages=p)},isDisabled:m,isReadonly:v,isValidating:_,items:i,validateOn:$(e,"validateOn")}),{errors:h,isDisabled:m,isReadonly:v,isValidating:_,items:i,validate:w,reset:u,resetValidation:y}}const be=J()({name:"VForm",props:{...Q(),..._e()},emits:{"update:modelValue":e=>!0,submit:e=>!0},setup(e,a){let{slots:m,emit:v}=a;const _=ye(e),i=V();function h(u){u.preventDefault(),_.reset()}function w(u){const y=u,n=_.validate();y.then=n.then.bind(n),y.catch=n.catch.bind(n),y.finally=n.finally.bind(n),v("submit",y),y.defaultPrevented||n.then(r=>{var d;let{valid:p}=r;p&&((d=i.value)==null||d.submit())}),y.preventDefault()}return K(()=>{var u;return t("form",{ref:i,class:["v-form",e.class],style:e.style,novalidate:!0,onReset:h,onSubmit:w},[(u=m.default)==null?void 0:u.call(m,_)])}),de(_,i)}}),ve={key:0,class:"px-3 py-10 d-flex flex-column justify-center align-center"},ke=s("span",null,"Connecting to websocket. If this takes too long, please refresh the page.",-1),xe=[ke],Ve={key:1},we={class:"d-flex flex-column"},Ie=s("span",{class:"text-md font-weight-bold"},"Order Details",-1),Se={class:"text-lg font-weight-bold"},Ce={class:"d-flex align-center text-md font-weight-medium mt-3"},Me={class:"ml-2"},Ae={class:"d-flex align-center text-md font-weight-medium"},De={class:"ml-2"},Re={class:"d-flex align-center text-md font-weight-medium"},Fe={class:"ml-2"},Oe=s("span",{class:"font-weight-bold"},"Item",-1),Te=s("div",{class:"d-flex justify-end"},[s("span",{class:"font-weight-bold"},"Amount")],-1),Ne=s("div",{class:"d-flex justify-end"},[s("span",{class:"font-weight-bold"},"Quantity")],-1),Ee={class:"text-sm font-weight-medium"},Be={class:"d-flex justify-end"},Pe={class:"text-sm font-weight-medium"},qe={class:"d-flex justify-end"},je={class:"text-sm font-weight-medium"},Ue={class:"mb-3"},We=s("span",{class:"font-weight-bold text-md"},"Personal Information",-1),Le=s("span",{class:"text-h5 font-weight-black"},"Pricing Details",-1),ze={class:"d-flex flex-row justify-space-between align-center mt-3 font-weight-medium"},Ye=s("span",null,"Total Amount",-1),$e={class:"d-flex flex-row justify-space-between align-center mt-3 font-weight-medium"},Je=s("span",null,"Unique Number",-1),Qe={class:"d-flex flex-row justify-space-between align-center mt-3 font-weight-bold mb-4"},Ke=s("span",null,"Total payment",-1),Ze={class:"text-lg"},Ge=s("span",{class:"font-weight-bold"},"Pay for Tickets",-1),at={__name:"order",setup(e){const a=pe(),m=Z(),v=le(),_=ae(),i=V(!1),h=V(!1),w=V(),u=N({fullName:"",email:"",phone:""}),y=N({type:"transfer",bank:"mandiri"}),n=S(()=>Math.floor(Math.random()*600)+100),r=S(()=>m.eventDetails),p=S(()=>v.ticketOrder),d=S(()=>{const k=v.ticketOrder;return k.length>0?k.reduce((f,x)=>f+x.amount,0):0}),C=async()=>{var f;const{valid:k}=await((f=w.value)==null?void 0:f.validate());if(k)try{h.value=!0;const x=v.ticketOrder.map(T=>({ticketId:T.ticketId,qty:T.qty})),F={connectionId:a.connectionId,data:{...u,eventId:m.eventDetails.eventId,bank:y.bank,items:x}};console.log("Connection ID: ",a.connectionId);const c=await v.createOrder(F);i.value=c||!1}finally{h.value=!1}};return G(()=>{m.eventDetails.eventId==""&&_.go(-1),a.connect()}),(k,f)=>{const x=B("AppTextField"),F=B("PaymentQueue");return I(),D("div",null,[o(a).isConnected?(I(),D("div",Ve,[t(be,{ref_key:"refForm",ref:w,onSubmit:f[4]||(f[4]=ne(()=>{},["prevent"]))},{default:l(()=>[o(h)?(I(),E(X,{key:0,indeterminate:"",rounded:"",height:"2",color:"primary"})):H("",!0),t(M,{class:"px-3 mb-4 mt-2"},{default:l(()=>[t(g,{cols:"12",md:"8"},{default:l(()=>[s("div",we,[t(R,{flat:"",class:"px-5 py-3 d-flex flex-column rounded-lg mb-2 border border-2 border-opacity-25"},{default:l(()=>[Ie,t(A,{class:"border-dashed border-opacity-25 my-3",thickness:"1"}),t(M,{"no-gutters":"",class:"my-3"},{default:l(()=>[t(g,null,{default:l(()=>[t(R,{flat:"",class:"rounded-lg"},{default:l(()=>[t(re,{"aspect-ratio":14/6,cover:"",src:o(r).image},null,8,["src"])]),_:1})]),_:1}),t(g,{class:"pa-0 pl-4"},{default:l(()=>[s("span",Se,b(o(r).title),1),s("div",Ce,[t(O,{size:18,icon:"tabler-calendar"}),s("span",Me,b(o(ie)(o(r).date).format("DD MMMM YYYY")),1)]),s("div",Ae,[t(O,{size:18,icon:"tabler-tag"}),s("span",De,b(o(r).category),1)]),s("div",Re,[t(O,{size:18,icon:"tabler-map-pin"}),s("span",Fe,b(o(r).location),1)])]),_:1})]),_:1}),t(A,{class:"border-dashed border-opacity-25 my-3",thickness:"1"}),t(M,{"no-gutters":""},{default:l(()=>[t(g,{col:"8"},{default:l(()=>[Oe]),_:1}),t(g,{col:"2"},{default:l(()=>[Te]),_:1}),t(g,{col:"1"},{default:l(()=>[Ne]),_:1})]),_:1}),t(A,{class:"border-dashed border-opacity-25 my-3",thickness:"1"}),(I(!0),D(ee,null,te(o(p),c=>(I(),E(M,{key:c.ticketId,"no-gutters":"",class:"mb-2"},{default:l(()=>[t(g,{col:"8"},{default:l(()=>[s("span",Ee,b(c.title),1)]),_:2},1024),t(g,{col:"3"},{default:l(()=>[s("div",Be,[s("span",Pe,"Rp. "+b(parseInt(c.amount).toLocaleString("id-ID")),1)])]),_:2},1024),t(g,{col:"1"},{default:l(()=>[s("div",qe,[s("span",je,b(c.qty)+"x",1)])]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(R,{flat:"",class:"px-5 py-3 d-flex flex-column rounded-lg mt-4 border border-2 border-opacity-25"},{default:l(()=>[s("div",Ue,[We,t(A,{class:"border-dashed border-opacity-20 my-3"}),t(M,{"no-gutters":"",class:"mt-2"},{default:l(()=>[t(g,{cols:"12",class:"mt-1"},{default:l(()=>[t(x,{modelValue:o(u).fullName,"onUpdate:modelValue":f[0]||(f[0]=c=>o(u).fullName=c),label:"Full Name*",density:"compact",placeholder:"Full name according to identity card",rules:[c=>!!c||"Full Name is required"]},null,8,["modelValue","rules"])]),_:1}),t(g,{cols:"12",class:"mt-3"},{default:l(()=>[t(x,{modelValue:o(u).email,"onUpdate:modelValue":f[1]||(f[1]=c=>o(u).email=c),label:"Email*",density:"compact",placeholder:"Active email",hint:"E-Ticket and order details will be sent to your email",rules:[o(P),o(fe)]},null,8,["modelValue","rules"])]),_:1}),t(g,{cols:"12",class:"mt-3"},{default:l(()=>[t(x,{modelValue:o(u).phone,"onUpdate:modelValue":f[2]||(f[2]=c=>o(u).phone=c),label:"Phone*",density:"compact",placeholder:"Your whatapp number",hint:"This number is used for alternative notifications",rules:[o(P),o(me)]},null,8,["modelValue","rules"])]),_:1})]),_:1})])]),_:1})])]),_:1}),t(g,{cols:"12",md:"4",class:"px-3"},{default:l(()=>[t(R,{class:"pa-4 rounded-lg d-flex flex-column"},{default:l(()=>[Le,s("div",ze,[Ye,s("span",null,"Rp "+b(parseInt(o(d)).toLocaleString("id-ID")),1)]),s("div",$e,[Je,s("span",null,"Rp "+b(o(n)),1)]),t(A,{class:"border-dashed border-opacity-25 my-3",thickness:"1"}),s("div",Qe,[Ke,s("span",Ze,"Rp "+b(parseInt(o(d)+o(n)).toLocaleString("id-ID")),1)]),t(se,{variant:"tonal",rounded:"lg",loading:o(h),onClick:C,disabled:o(h)},{default:l(()=>[Ge]),_:1},8,["loading","disabled"]),t(F,{modelValue:o(i),"onUpdate:modelValue":f[3]||(f[3]=c=>oe(i)?i.value=c:null),totalAmount:o(d)+o(n)},null,8,["modelValue","totalAmount"])]),_:1})]),_:1})]),_:1})]),_:1},512)])):(I(),D("div",ve,xe))])}}};export{at as default};
